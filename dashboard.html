<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitstop Dashboard ‚Äî BlackRoad</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a0a;
            --bg-medium: #121212;
            --bg-light: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent-orange: #FF9D00;
            --accent-red: #FF006B;
            --accent-purple: #7700FF;
            --accent-blue: #0066FF;
            --accent-green: #27AE60;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: var(--bg-medium);
            border-bottom: 1px solid var(--glass-border);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: 900;
            background: linear-gradient(45deg, var(--accent-orange), var(--accent-red), var(--accent-purple));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .breadcrumb {
            font-size: 14px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--glass-bg);
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--accent-purple), var(--accent-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
        }

        .logout-button {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
            color: #E74C3C;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-button:hover {
            background: rgba(231, 76, 60, 0.2);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 40px;
        }

        /* File Grid */
        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .file-card {
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .file-card:hover {
            border-color: var(--accent-purple);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(119, 0, 255, 0.2);
        }

        .file-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-orange), var(--accent-red), var(--accent-purple));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .file-card:hover::before {
            opacity: 1;
        }

        .file-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .file-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .file-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .file-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .file-badge {
            display: inline-block;
            background: rgba(255, 157, 0, 0.1);
            color: var(--accent-orange);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .file-badge.live {
            background: rgba(39, 174, 96, 0.1);
            color: var(--accent-green);
        }

        .file-badge.protected {
            background: rgba(231, 76, 60, 0.1);
            color: #E74C3C;
        }

        /* Stats Section */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        /* ============================================
           TOAST NOTIFICATION SYSTEM
           ============================================ */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background: var(--bg-dark);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: toastSlideIn 0.3s ease;
            pointer-events: auto;
            backdrop-filter: blur(20px);
            max-width: 380px;
        }

        .toast.hiding {
            animation: toastSlideOut 0.3s ease forwards;
        }

        @keyframes toastSlideIn {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes toastSlideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100px); }
        }

        .toast-icon { font-size: 20px; flex-shrink: 0; }
        .toast-content { flex: 1; }
        .toast-title { font-weight: 600; font-size: 14px; margin-bottom: 2px; }
        .toast-message { font-size: 13px; color: var(--text-secondary); }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            font-size: 18px;
            line-height: 1;
            transition: color 0.2s;
        }

        .toast-close:hover { color: var(--text-primary); }
        .toast.success { border-left: 4px solid var(--accent-green); }
        .toast.error { border-left: 4px solid #E74C3C; }
        .toast.warning { border-left: 4px solid var(--accent-orange); }
        .toast.info { border-left: 4px solid var(--accent-blue); }

        /* ============================================
           SEARCH & FILTER BAR
           ============================================ */
        .search-bar {
            display: flex;
            gap: 16px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .search-input-wrapper {
            flex: 1;
            min-width: 280px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 14px 20px 14px 48px;
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 3px rgba(119, 0, 255, 0.1);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-secondary);
        }

        .search-clear {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px 8px;
            font-size: 14px;
            border-radius: 4px;
            display: none;
        }

        .search-clear.show { display: block; }
        .search-clear:hover { color: var(--text-primary); background: var(--glass-bg); }

        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 12px 20px;
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }

        .filter-btn:hover {
            border-color: var(--accent-purple);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
            color: white;
        }

        .filter-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 6px;
            font-size: 11px;
        }

        /* ============================================
           FAVORITES FEATURE
           ============================================ */
        .favorite-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            opacity: 0.3;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .favorite-btn:hover { opacity: 1; transform: scale(1.2); }
        .favorite-btn.favorited { opacity: 1; }
        .file-card { position: relative; }

        /* ============================================
           FILE PREVIEW MODAL
           ============================================ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow: hidden;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-close {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(231, 76, 60, 0.1);
            border-color: rgba(231, 76, 60, 0.3);
            color: #E74C3C;
        }

        .modal-body {
            padding: 24px;
            max-height: calc(85vh - 140px);
            overflow-y: auto;
        }

        .modal-body pre {
            background: var(--bg-dark);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .modal-btn-primary {
            background: linear-gradient(45deg, var(--accent-orange), var(--accent-red));
            border: none;
            color: white;
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 157, 0, 0.3);
        }

        .modal-btn-secondary {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
        }

        .modal-btn-secondary:hover {
            border-color: var(--accent-purple);
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--glass-border);
            border-top-color: var(--accent-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* ============================================
           SESSION EXPIRY BANNER
           ============================================ */
        .session-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, var(--accent-orange), var(--accent-red));
            color: white;
            padding: 12px 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            z-index: 200;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .session-banner.show { transform: translateY(0); }

        .session-banner button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 6px 16px;
            border-radius: 6px;
            margin-left: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .session-banner button:hover { background: rgba(255, 255, 255, 0.3); }

        /* ============================================
           KEYBOARD SHORTCUTS PANEL
           ============================================ */
        .shortcuts-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 12px;
            color: var(--text-secondary);
            z-index: 50;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .shortcuts-panel:hover { opacity: 1; }

        .shortcuts-panel kbd {
            background: var(--glass-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            border: 1px solid var(--glass-border);
            margin: 0 2px;
        }

        .shortcuts-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 10px 14px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            z-index: 49;
            transition: all 0.2s;
        }

        .shortcuts-toggle:hover { border-color: var(--accent-purple); color: var(--text-primary); }

        /* ============================================
           EMPTY STATE
           ============================================ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .empty-state-message { font-size: 14px; }

        /* ============================================
           ACCESSIBILITY & FOCUS STATES
           ============================================ */
        .file-card:focus-visible,
        .filter-btn:focus-visible,
        .search-input:focus-visible,
        .modal-close:focus-visible {
            outline: 2px solid var(--accent-purple);
            outline-offset: 2px;
        }

        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent-purple);
            color: white;
            padding: 8px 16px;
            z-index: 1002;
            text-decoration: none;
            border-radius: 0 0 8px 0;
            transition: top 0.3s;
        }

        .skip-link:focus { top: 0; }

        /* View toggle */
        .view-toggle {
            display: flex;
            gap: 4px;
            background: var(--bg-medium);
            padding: 4px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
        }

        .view-btn {
            padding: 8px 12px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.2s;
        }

        .view-btn.active {
            background: var(--accent-purple);
            color: white;
        }

        .view-btn:hover:not(.active) {
            color: var(--text-primary);
        }

        /* List view */
        .file-grid.list-view {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .file-grid.list-view .file-card {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            gap: 16px;
        }

        .file-grid.list-view .file-icon {
            font-size: 28px;
            margin-bottom: 0;
        }

        .file-grid.list-view .file-title {
            margin-bottom: 2px;
        }

        .file-grid.list-view .file-description {
            margin-bottom: 0;
            flex: 1;
        }
    </style>
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#file-grid" class="skip-link">Skip to files</a>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container" role="alert" aria-live="polite"></div>

    <!-- Session Expiry Banner -->
    <div class="session-banner" id="session-banner" role="alert">
        <span id="session-message">Your session will expire in <strong id="session-countdown">5:00</strong></span>
        <button onclick="extendSession()" aria-label="Extend session">Extend Session</button>
    </div>

    <!-- File Preview Modal -->
    <div class="modal-overlay" id="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">
                    <span id="modal-icon">üìÑ</span>
                    <span id="modal-filename">filename.js</span>
                </h2>
                <button class="modal-close" onclick="closeModal()" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="modal-footer">
                <span id="modal-meta" class="text-secondary" style="font-size: 13px; color: var(--text-secondary);">Loading...</span>
                <div class="modal-actions">
                    <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Close</button>
                    <button class="modal-btn modal-btn-primary" id="modal-open-btn" onclick="openFileExternal()">Open File</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-left">
            <div class="logo" aria-label="Pitstop Dashboard">PITSTOP</div>
            <nav class="breadcrumb" aria-label="Breadcrumb">/ dashboard</nav>
        </div>
        <div class="header-right">
            <div class="user-info" role="status" aria-label="User information">
                <div class="user-avatar" id="user-avatar" aria-hidden="true">A</div>
                <div class="user-name" id="user-name">Loading...</div>
            </div>
            <button class="logout-button" onclick="logout()" aria-label="Logout from Pitstop">Logout</button>
        </div>
    </header>

    <!-- Main Container -->
    <main class="container" role="main">
        <h1 class="page-title">Welcome to Pitstop</h1>
        <p class="page-subtitle">Secure access to all BlackRoad OS systems and files</p>

        <!-- Search & Filter Bar -->
        <div class="search-bar" role="search">
            <div class="search-input-wrapper">
                <span class="search-icon" aria-hidden="true">üîç</span>
                <input
                    type="text"
                    class="search-input"
                    id="search-input"
                    placeholder="Search files... (Press / to focus)"
                    aria-label="Search files"
                />
                <button class="search-clear" id="search-clear" aria-label="Clear search">&times;</button>
            </div>
            <div class="filter-buttons" role="group" aria-label="Filter by category">
                <button class="filter-btn active" data-filter="all">All<span class="filter-count" id="count-all">17</span></button>
                <button class="filter-btn" data-filter="live">Live<span class="filter-count" id="count-live">2</span></button>
                <button class="filter-btn" data-filter="system">System<span class="filter-count" id="count-system">12</span></button>
                <button class="filter-btn" data-filter="docs">Docs<span class="filter-count" id="count-docs">2</span></button>
                <button class="filter-btn" data-filter="favorites">‚òÖ Favorites<span class="filter-count" id="count-favorites">0</span></button>
            </div>
            <div class="view-toggle" role="group" aria-label="View mode">
                <button class="view-btn active" data-view="grid" aria-label="Grid view" title="Grid view">‚ñ¶</button>
                <button class="view-btn" data-view="list" aria-label="List view" title="List view">‚ò∞</button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìÅ</div>
                <div class="stat-label">Total Files</div>
                <div class="stat-value">32</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üåå</div>
                <div class="stat-label">Systems</div>
                <div class="stat-value">18</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üíª</div>
                <div class="stat-label">Code Lines</div>
                <div class="stat-value">14K+</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üöÄ</div>
                <div class="stat-label">Deployments</div>
                <div class="stat-value">3</div>
            </div>
        </div>

        <!-- File Grid -->
        <div class="file-grid" id="file-grid" role="grid" aria-label="File list">
            <!-- Metaverse Files -->
            <div class="file-card" onclick="openFile('universe.html')">
                <div class="file-icon">üåå</div>
                <div class="file-title">Complete Universe</div>
                <div class="file-description">Full integration of all 18 systems with beautiful UI</div>
                <div class="file-meta">
                    <span class="file-badge live">LIVE</span>
                    <span>981 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('index.html')">
                <div class="file-icon">üéÆ</div>
                <div class="file-title">Original Metaverse</div>
                <div class="file-description">First version with core features</div>
                <div class="file-meta">
                    <span class="file-badge live">LIVE</span>
                    <span>1,698 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('module-loader.js')">
                <div class="file-icon">üîó</div>
                <div class="file-title">Module Loader</div>
                <div class="file-description">Dynamic import system with dependency management</div>
                <div class="file-meta">
                    <span class="file-badge">MODULE</span>
                    <span>287 lines</span>
                </div>
            </div>

            <!-- System Files -->
            <div class="file-card" onclick="openFile('truth-contracts.js')">
                <div class="file-icon">üîê</div>
                <div class="file-title">Truth Contracts</div>
                <div class="file-description">Time scales, reference frames, and verification</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>382 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('celestial-mechanics.js')">
                <div class="file-icon">ü™ê</div>
                <div class="file-title">Celestial Mechanics</div>
                <div class="file-description">NASA-grade IAU 2000/2006 transformations</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>500 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('physics-engine.js')">
                <div class="file-icon">‚ö°</div>
                <div class="file-title">Physics Engine</div>
                <div class="file-description">Rigid body dynamics and collision detection</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>632 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('living-nature.js')">
                <div class="file-icon">ü¶ã</div>
                <div class="file-title">Living Nature</div>
                <div class="file-description">6 animals + 6 plants with AI emotions</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>1,177 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('intelligent-agents.js')">
                <div class="file-icon">ü§ñ</div>
                <div class="file-title">Intelligent Agents</div>
                <div class="file-description">Alice, Aria, Lucidia with behavior trees</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>862 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('infinite-biomes.js')">
                <div class="file-icon">üå≤</div>
                <div class="file-title">Infinite Biomes</div>
                <div class="file-description">6 procedurally generated biomes</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>492 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('photorealistic-graphics.js')">
                <div class="file-icon">üé®</div>
                <div class="file-title">Photorealistic Graphics</div>
                <div class="file-description">PBR materials and custom GLSL shaders</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>743 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('game-integration.js')">
                <div class="file-icon">üéØ</div>
                <div class="file-title">Game Integration</div>
                <div class="file-description">System orchestrator for all 17 modules</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>890 lines</span>
                </div>
            </div>

            <!-- Other Systems -->
            <div class="file-card" onclick="openFile('crafting-building.js')">
                <div class="file-icon">üõ†Ô∏è</div>
                <div class="file-title">Crafting & Building</div>
                <div class="file-description">Material system with 30+ recipes</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>741 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('quest-system.js')">
                <div class="file-icon">üèÜ</div>
                <div class="file-title">Quest System</div>
                <div class="file-description">12 unique quests with achievements</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>676 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('dialogue-story.js')">
                <div class="file-icon">üí¨</div>
                <div class="file-title">Dialogue & Story</div>
                <div class="file-description">Branching conversations and story arcs</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>674 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('world-evolution.js')">
                <div class="file-icon">üåç</div>
                <div class="file-title">World Evolution</div>
                <div class="file-description">Seasons, weather, and ecosystem simulation</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>673 lines</span>
                </div>
            </div>

            <!-- Documentation -->
            <div class="file-card" onclick="openFile('STATUS.md')">
                <div class="file-icon">üìä</div>
                <div class="file-title">Complete Status</div>
                <div class="file-description">Full project documentation and metrics</div>
                <div class="file-meta">
                    <span class="file-badge">DOCS</span>
                    <span>561 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('DOMAIN_SETUP.md')">
                <div class="file-icon">üåê</div>
                <div class="file-title">Domain Setup Guide</div>
                <div class="file-description">Instructions for universe.blackroad.io</div>
                <div class="file-meta">
                    <span class="file-badge">DOCS</span>
                    <span>244 lines</span>
                </div>
            </div>
        </div>

        <!-- Empty State (shown when no results) -->
        <div class="empty-state" id="empty-state" style="display: none;">
            <div class="empty-state-icon">üîç</div>
            <div class="empty-state-title">No files found</div>
            <div class="empty-state-message">Try adjusting your search or filter criteria</div>
        </div>
    </main>

    <!-- Keyboard Shortcuts Panel -->
    <div class="shortcuts-panel" id="shortcuts-panel" aria-hidden="true">
        <div style="margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Keyboard Shortcuts</div>
        <div><kbd>/</kbd> Focus search</div>
        <div><kbd>Esc</kbd> Clear/Close</div>
        <div><kbd>G</kbd> Grid view</div>
        <div><kbd>L</kbd> List view</div>
        <div><kbd>?</kbd> Toggle help</div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION & CONSTANTS
        // ============================================
        const SESSION_KEY = 'blackroad_pitstop_session';
        const FAVORITES_KEY = 'blackroad_favorites';
        const SESSION_DURATION = 24 * 60 * 60 * 1000; // 24 hours
        const SESSION_WARNING_TIME = 5 * 60 * 1000; // 5 minutes before expiry

        // File database with metadata
        const FILES_DB = [
            { id: 'universe.html', name: 'Complete Universe', icon: 'üåå', desc: 'Full integration of all 18 systems with beautiful UI', lines: 981, badge: 'live', category: 'live' },
            { id: 'index.html', name: 'Original Metaverse', icon: 'üéÆ', desc: 'First version with core features', lines: 1698, badge: 'live', category: 'live' },
            { id: 'module-loader.js', name: 'Module Loader', icon: 'üîó', desc: 'Dynamic import system with dependency management', lines: 287, badge: 'module', category: 'system' },
            { id: 'truth-contracts.js', name: 'Truth Contracts', icon: 'üîê', desc: 'Time scales, reference frames, and verification', lines: 382, badge: 'system', category: 'system' },
            { id: 'celestial-mechanics.js', name: 'Celestial Mechanics', icon: 'ü™ê', desc: 'NASA-grade IAU 2000/2006 transformations', lines: 500, badge: 'system', category: 'system' },
            { id: 'physics-engine.js', name: 'Physics Engine', icon: '‚ö°', desc: 'Rigid body dynamics and collision detection', lines: 632, badge: 'system', category: 'system' },
            { id: 'living-nature.js', name: 'Living Nature', icon: 'ü¶ã', desc: '6 animals + 6 plants with AI emotions', lines: 1177, badge: 'system', category: 'system' },
            { id: 'intelligent-agents.js', name: 'Intelligent Agents', icon: 'ü§ñ', desc: 'Alice, Aria, Lucidia with behavior trees', lines: 862, badge: 'system', category: 'system' },
            { id: 'infinite-biomes.js', name: 'Infinite Biomes', icon: 'üå≤', desc: '6 procedurally generated biomes', lines: 492, badge: 'system', category: 'system' },
            { id: 'photorealistic-graphics.js', name: 'Photorealistic Graphics', icon: 'üé®', desc: 'PBR materials and custom GLSL shaders', lines: 743, badge: 'system', category: 'system' },
            { id: 'game-integration.js', name: 'Game Integration', icon: 'üéØ', desc: 'System orchestrator for all 17 modules', lines: 890, badge: 'system', category: 'system' },
            { id: 'crafting-building.js', name: 'Crafting & Building', icon: 'üõ†Ô∏è', desc: 'Material system with 30+ recipes', lines: 741, badge: 'system', category: 'system' },
            { id: 'quest-system.js', name: 'Quest System', icon: 'üèÜ', desc: '12 unique quests with achievements', lines: 676, badge: 'system', category: 'system' },
            { id: 'dialogue-story.js', name: 'Dialogue & Story', icon: 'üí¨', desc: 'Branching conversations and story arcs', lines: 674, badge: 'system', category: 'system' },
            { id: 'world-evolution.js', name: 'World Evolution', icon: 'üåç', desc: 'Seasons, weather, and ecosystem simulation', lines: 673, badge: 'system', category: 'system' },
            { id: 'STATUS.md', name: 'Complete Status', icon: 'üìä', desc: 'Full project documentation and metrics', lines: 561, badge: 'docs', category: 'docs' },
            { id: 'DOMAIN_SETUP.md', name: 'Domain Setup Guide', icon: 'üåê', desc: 'Instructions for universe.blackroad.io', lines: 244, badge: 'docs', category: 'docs' }
        ];

        const FILE_URL_MAP = {
            'universe.html': '../blackroad-metaverse/universe.html',
            'index.html': '../blackroad-metaverse/index.html',
            'module-loader.js': '../blackroad-metaverse/module-loader.js',
            'truth-contracts.js': '../blackroad-metaverse/truth-contracts.js',
            'celestial-mechanics.js': '../blackroad-metaverse/celestial-mechanics.js',
            'physics-engine.js': '../blackroad-metaverse/physics-engine.js',
            'living-nature.js': '../blackroad-metaverse/living-nature.js',
            'intelligent-agents.js': '../blackroad-metaverse/intelligent-agents.js',
            'infinite-biomes.js': '../blackroad-metaverse/infinite-biomes.js',
            'photorealistic-graphics.js': '../blackroad-metaverse/photorealistic-graphics.js',
            'game-integration.js': '../blackroad-metaverse/game-integration.js',
            'crafting-building.js': '../blackroad-metaverse/crafting-building.js',
            'quest-system.js': '../blackroad-metaverse/quest-system.js',
            'dialogue-story.js': '../blackroad-metaverse/dialogue-story.js',
            'world-evolution.js': '../blackroad-metaverse/world-evolution.js',
            'STATUS.md': '../blackroad-metaverse/STATUS.md',
            'DOMAIN_SETUP.md': '../blackroad-metaverse/DOMAIN_SETUP.md'
        };

        // ============================================
        // TOAST NOTIFICATION SYSTEM
        // ============================================
        const toastContainer = document.getElementById('toast-container');

        function showToast(type, title, message, duration = 4000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icons = { success: '‚úì', error: '‚úï', warning: '‚ö†', info: '‚Ñπ' };

            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || '‚Ñπ'}</span>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" aria-label="Close">&times;</button>
            `;

            toast.querySelector('.toast-close').onclick = () => dismissToast(toast);
            toastContainer.appendChild(toast);

            if (duration > 0) setTimeout(() => dismissToast(toast), duration);
            return toast;
        }

        function dismissToast(toast) {
            if (!toast || toast.classList.contains('hiding')) return;
            toast.classList.add('hiding');
            setTimeout(() => toast.remove(), 300);
        }

        // ============================================
        // SESSION MANAGEMENT
        // ============================================
        let sessionCheckInterval;
        let currentFile = null;

        function checkAuth() {
            const session = localStorage.getItem(SESSION_KEY);
            if (!session) {
                window.location.href = 'index.html';
                return null;
            }

            try {
                const sessionData = JSON.parse(session);
                const now = Date.now();

                if (sessionData.expires < now) {
                    localStorage.removeItem(SESSION_KEY);
                    showToast('warning', 'Session Expired', 'Redirecting to login...');
                    setTimeout(() => window.location.href = 'index.html', 1500);
                    return null;
                }

                return sessionData;
            } catch (e) {
                localStorage.removeItem(SESSION_KEY);
                window.location.href = 'index.html';
                return null;
            }
        }

        function startSessionMonitor() {
            sessionCheckInterval = setInterval(() => {
                const session = localStorage.getItem(SESSION_KEY);
                if (!session) return;

                const sessionData = JSON.parse(session);
                const timeLeft = sessionData.expires - Date.now();

                if (timeLeft <= 0) {
                    clearInterval(sessionCheckInterval);
                    showToast('error', 'Session Expired', 'Please log in again.');
                    setTimeout(() => window.location.href = 'index.html', 2000);
                } else if (timeLeft <= SESSION_WARNING_TIME) {
                    const minutes = Math.floor(timeLeft / 60000);
                    const seconds = Math.floor((timeLeft % 60000) / 1000);
                    document.getElementById('session-countdown').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    document.getElementById('session-banner').classList.add('show');
                }
            }, 1000);
        }

        function extendSession() {
            const session = localStorage.getItem(SESSION_KEY);
            if (session) {
                const sessionData = JSON.parse(session);
                sessionData.expires = Date.now() + SESSION_DURATION;
                localStorage.setItem(SESSION_KEY, JSON.stringify(sessionData));
                document.getElementById('session-banner').classList.remove('show');
                showToast('success', 'Session Extended', 'Your session has been extended for 24 hours.');
            }
        }

        // ============================================
        // FAVORITES SYSTEM
        // ============================================
        function getFavorites() {
            const data = localStorage.getItem(FAVORITES_KEY);
            return data ? JSON.parse(data) : [];
        }

        function saveFavorites(favorites) {
            localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
            updateFavoritesCount();
        }

        function toggleFavorite(fileId, event) {
            event.stopPropagation();
            const favorites = getFavorites();
            const index = favorites.indexOf(fileId);

            if (index > -1) {
                favorites.splice(index, 1);
                showToast('info', 'Removed from Favorites', `${fileId} removed from favorites`);
            } else {
                favorites.push(fileId);
                showToast('success', 'Added to Favorites', `${fileId} added to favorites`);
            }

            saveFavorites(favorites);
            renderFileGrid();
        }

        function isFavorite(fileId) {
            return getFavorites().includes(fileId);
        }

        function updateFavoritesCount() {
            document.getElementById('count-favorites').textContent = getFavorites().length;
        }

        // ============================================
        // FILE GRID RENDERING
        // ============================================
        let currentFilter = 'all';
        let currentSearch = '';
        let currentView = 'grid';

        function renderFileGrid() {
            const grid = document.getElementById('file-grid');
            const emptyState = document.getElementById('empty-state');
            const favorites = getFavorites();

            // Filter files
            let filteredFiles = FILES_DB.filter(file => {
                const matchesSearch = currentSearch === '' ||
                    file.name.toLowerCase().includes(currentSearch.toLowerCase()) ||
                    file.desc.toLowerCase().includes(currentSearch.toLowerCase()) ||
                    file.id.toLowerCase().includes(currentSearch.toLowerCase());

                const matchesFilter = currentFilter === 'all' ||
                    (currentFilter === 'favorites' && favorites.includes(file.id)) ||
                    file.category === currentFilter;

                return matchesSearch && matchesFilter;
            });

            // Clear and rebuild grid
            grid.innerHTML = '';

            if (filteredFiles.length === 0) {
                emptyState.style.display = 'block';
                grid.style.display = 'none';
            } else {
                emptyState.style.display = 'none';
                grid.style.display = '';
                grid.className = `file-grid ${currentView === 'list' ? 'list-view' : ''}`;

                filteredFiles.forEach(file => {
                    const isFav = favorites.includes(file.id);
                    const card = document.createElement('div');
                    card.className = 'file-card';
                    card.setAttribute('tabindex', '0');
                    card.setAttribute('role', 'button');
                    card.setAttribute('aria-label', `${file.name}: ${file.desc}`);
                    card.onclick = () => openFile(file.id);
                    card.onkeydown = (e) => { if (e.key === 'Enter') openFile(file.id); };

                    card.innerHTML = `
                        <button class="favorite-btn ${isFav ? 'favorited' : ''}"
                                onclick="toggleFavorite('${file.id}', event)"
                                aria-label="${isFav ? 'Remove from favorites' : 'Add to favorites'}"
                                title="${isFav ? 'Remove from favorites' : 'Add to favorites'}">
                            ${isFav ? '‚òÖ' : '‚òÜ'}
                        </button>
                        <div class="file-icon">${file.icon}</div>
                        <div class="file-title">${file.name}</div>
                        <div class="file-description">${file.desc}</div>
                        <div class="file-meta">
                            <span class="file-badge ${file.badge}">${file.badge.toUpperCase()}</span>
                            <span>${file.lines.toLocaleString()} lines</span>
                        </div>
                    `;

                    grid.appendChild(card);
                });
            }

            // Update counts
            updateFilterCounts();
        }

        function updateFilterCounts() {
            const favorites = getFavorites();
            document.getElementById('count-all').textContent = FILES_DB.length;
            document.getElementById('count-live').textContent = FILES_DB.filter(f => f.category === 'live').length;
            document.getElementById('count-system').textContent = FILES_DB.filter(f => f.category === 'system').length;
            document.getElementById('count-docs').textContent = FILES_DB.filter(f => f.category === 'docs').length;
            document.getElementById('count-favorites').textContent = favorites.length;
        }

        // ============================================
        // SEARCH & FILTER
        // ============================================
        const searchInput = document.getElementById('search-input');
        const searchClear = document.getElementById('search-clear');

        searchInput.addEventListener('input', (e) => {
            currentSearch = e.target.value;
            searchClear.classList.toggle('show', currentSearch.length > 0);
            renderFileGrid();
        });

        searchClear.addEventListener('click', () => {
            searchInput.value = '';
            currentSearch = '';
            searchClear.classList.remove('show');
            renderFileGrid();
            searchInput.focus();
        });

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                renderFileGrid();
            });
        });

        // View toggle
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentView = btn.dataset.view;
                renderFileGrid();
            });
        });

        // ============================================
        // FILE PREVIEW MODAL
        // ============================================
        const modalOverlay = document.getElementById('modal-overlay');

        function openFile(filename) {
            const file = FILES_DB.find(f => f.id === filename);
            const url = FILE_URL_MAP[filename];

            if (!file || !url) return;

            currentFile = { ...file, url };

            // For HTML files, open directly
            if (filename.endsWith('.html')) {
                window.open(url, '_blank');
                showToast('info', 'Opening File', `${file.name} opened in new tab`);
                return;
            }

            // For other files, show preview modal
            document.getElementById('modal-icon').textContent = file.icon;
            document.getElementById('modal-filename').textContent = file.name;
            document.getElementById('modal-meta').textContent = `${file.lines.toLocaleString()} lines ‚Ä¢ ${file.category.toUpperCase()}`;

            const modalBody = document.getElementById('modal-body');
            modalBody.innerHTML = '<div class="loading-spinner"><div class="spinner"></div></div>';

            modalOverlay.classList.add('show');
            document.body.style.overflow = 'hidden';

            // Simulate loading file content (in real app, fetch the file)
            setTimeout(() => {
                const sampleContent = generateSampleContent(file);
                modalBody.innerHTML = `<pre><code>${escapeHtml(sampleContent)}</code></pre>`;
            }, 500);
        }

        function generateSampleContent(file) {
            if (file.id.endsWith('.md')) {
                return `# ${file.name}\n\n${file.desc}\n\n## Overview\nThis file contains ${file.lines} lines of documentation.\n\n## Contents\n- Section 1: Introduction\n- Section 2: Configuration\n- Section 3: Usage Examples\n- Section 4: API Reference\n\n---\n*BlackRoad OS Documentation*`;
            }
            return `/**\n * ${file.name}\n * ${file.desc}\n * \n * @module ${file.id.replace('.js', '')}\n * @version 1.0.0\n * @lines ${file.lines}\n */\n\nclass ${file.name.replace(/[^a-zA-Z]/g, '')} {\n    constructor() {\n        this.initialized = false;\n        this.config = {};\n    }\n\n    async init() {\n        console.log('Initializing ${file.name}...');\n        this.initialized = true;\n        return this;\n    }\n\n    // ... ${file.lines - 20} more lines of code\n}\n\nexport default ${file.name.replace(/[^a-zA-Z]/g, '')};`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function closeModal() {
            modalOverlay.classList.remove('show');
            document.body.style.overflow = '';
            currentFile = null;
        }

        function openFileExternal() {
            if (currentFile && currentFile.url) {
                window.open(currentFile.url, '_blank');
                showToast('info', 'Opening File', `${currentFile.name} opened in new tab`);
            }
        }

        // Close modal on escape or clicking overlay
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) closeModal();
        });

        // ============================================
        // KEYBOARD SHORTCUTS
        // ============================================
        const shortcutsPanel = document.getElementById('shortcuts-panel');
        let shortcutsVisible = true;

        document.addEventListener('keydown', (e) => {
            // Ignore if typing in input
            if (e.target.tagName === 'INPUT') {
                if (e.key === 'Escape') {
                    e.target.blur();
                    searchInput.value = '';
                    currentSearch = '';
                    searchClear.classList.remove('show');
                    renderFileGrid();
                }
                return;
            }

            switch (e.key) {
                case '/':
                    e.preventDefault();
                    searchInput.focus();
                    break;
                case 'Escape':
                    if (modalOverlay.classList.contains('show')) {
                        closeModal();
                    }
                    break;
                case 'g':
                case 'G':
                    document.querySelector('[data-view="grid"]').click();
                    showToast('info', 'View Changed', 'Switched to grid view');
                    break;
                case 'l':
                case 'L':
                    document.querySelector('[data-view="list"]').click();
                    showToast('info', 'View Changed', 'Switched to list view');
                    break;
                case '?':
                    shortcutsVisible = !shortcutsVisible;
                    shortcutsPanel.style.display = shortcutsVisible ? 'block' : 'none';
                    break;
                case '1':
                    document.querySelector('[data-filter="all"]').click();
                    break;
                case '2':
                    document.querySelector('[data-filter="live"]').click();
                    break;
                case '3':
                    document.querySelector('[data-filter="system"]').click();
                    break;
                case '4':
                    document.querySelector('[data-filter="docs"]').click();
                    break;
                case '5':
                    document.querySelector('[data-filter="favorites"]').click();
                    break;
            }
        });

        // ============================================
        // LOGOUT
        // ============================================
        function logout() {
            showToast('info', 'Logging Out', 'See you soon!');
            setTimeout(() => {
                localStorage.removeItem(SESSION_KEY);
                window.location.href = 'index.html';
            }, 1000);
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        const session = checkAuth();
        if (session) {
            document.getElementById('user-name').textContent = session.username;
            document.getElementById('user-avatar').textContent = session.username.charAt(0).toUpperCase();

            // Start session monitoring
            startSessionMonitor();

            // Initial render
            renderFileGrid();

            // Welcome toast
            showToast('success', `Welcome, ${session.username}!`, 'You have access to all BlackRoad files.');
        }
    </script>
</body>
</html>
