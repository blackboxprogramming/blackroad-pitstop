<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitstop Dashboard ‚Äî BlackRoad</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a0a;
            --bg-medium: #121212;
            --bg-light: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent-orange: #FF9D00;
            --accent-red: #FF006B;
            --accent-purple: #7700FF;
            --accent-blue: #0066FF;
            --accent-green: #27AE60;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: var(--bg-medium);
            border-bottom: 1px solid var(--glass-border);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: 900;
            background: linear-gradient(45deg, var(--accent-orange), var(--accent-red), var(--accent-purple));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .breadcrumb {
            font-size: 14px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--glass-bg);
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--accent-purple), var(--accent-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
        }

        .logout-button {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
            color: #E74C3C;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-button:hover {
            background: rgba(231, 76, 60, 0.2);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 40px;
        }

        /* File Grid */
        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .file-card {
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .file-card:hover {
            border-color: var(--accent-purple);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(119, 0, 255, 0.2);
        }

        .file-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-orange), var(--accent-red), var(--accent-purple));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .file-card:hover::before {
            opacity: 1;
        }

        .file-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .file-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .file-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .file-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .file-badge {
            display: inline-block;
            background: rgba(255, 157, 0, 0.1);
            color: var(--accent-orange);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .file-badge.live {
            background: rgba(39, 174, 96, 0.1);
            color: var(--accent-green);
        }

        .file-badge.protected {
            background: rgba(231, 76, 60, 0.1);
            color: #E74C3C;
        }

        /* Stats Section */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        /* ============================================
           TOAST NOTIFICATION SYSTEM
           ============================================ */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background: var(--bg-dark);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            animation: toastSlideIn 0.3s ease;
            pointer-events: auto;
            backdrop-filter: blur(20px);
            max-width: 380px;
        }

        .toast.hiding {
            animation: toastSlideOut 0.3s ease forwards;
        }

        @keyframes toastSlideIn {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes toastSlideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100px); }
        }

        .toast-icon { font-size: 20px; flex-shrink: 0; }
        .toast-content { flex: 1; }
        .toast-title { font-weight: 600; font-size: 14px; margin-bottom: 2px; }
        .toast-message { font-size: 13px; color: var(--text-secondary); }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            font-size: 18px;
            line-height: 1;
            transition: color 0.2s;
        }

        .toast-close:hover { color: var(--text-primary); }
        .toast.success { border-left: 4px solid var(--accent-green); }
        .toast.error { border-left: 4px solid #E74C3C; }
        .toast.warning { border-left: 4px solid var(--accent-orange); }
        .toast.info { border-left: 4px solid var(--accent-blue); }

        /* ============================================
           SEARCH & FILTER BAR
           ============================================ */
        .search-bar {
            display: flex;
            gap: 16px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .search-input-wrapper {
            flex: 1;
            min-width: 280px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 14px 20px 14px 48px;
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 3px rgba(119, 0, 255, 0.1);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-secondary);
        }

        .search-clear {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px 8px;
            font-size: 14px;
            border-radius: 4px;
            display: none;
        }

        .search-clear.show { display: block; }
        .search-clear:hover { color: var(--text-primary); background: var(--glass-bg); }

        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 12px 20px;
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }

        .filter-btn:hover {
            border-color: var(--accent-purple);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
            color: white;
        }

        .filter-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 6px;
            font-size: 11px;
        }

        /* ============================================
           FAVORITES FEATURE
           ============================================ */
        .favorite-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            opacity: 0.3;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .favorite-btn:hover { opacity: 1; transform: scale(1.2); }
        .favorite-btn.favorited { opacity: 1; }
        .file-card { position: relative; }

        /* ============================================
           FILE PREVIEW MODAL
           ============================================ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow: hidden;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-close {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(231, 76, 60, 0.1);
            border-color: rgba(231, 76, 60, 0.3);
            color: #E74C3C;
        }

        .modal-body {
            padding: 24px;
            max-height: calc(85vh - 140px);
            overflow-y: auto;
        }

        .modal-body pre {
            background: var(--bg-dark);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .modal-btn-primary {
            background: linear-gradient(45deg, var(--accent-orange), var(--accent-red));
            border: none;
            color: white;
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 157, 0, 0.3);
        }

        .modal-btn-secondary {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
        }

        .modal-btn-secondary:hover {
            border-color: var(--accent-purple);
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--glass-border);
            border-top-color: var(--accent-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* ============================================
           SESSION EXPIRY BANNER
           ============================================ */
        .session-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, var(--accent-orange), var(--accent-red));
            color: white;
            padding: 12px 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            z-index: 200;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .session-banner.show { transform: translateY(0); }

        .session-banner button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 6px 16px;
            border-radius: 6px;
            margin-left: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .session-banner button:hover { background: rgba(255, 255, 255, 0.3); }

        /* ============================================
           KEYBOARD SHORTCUTS PANEL
           ============================================ */
        .shortcuts-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 12px;
            color: var(--text-secondary);
            z-index: 50;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .shortcuts-panel:hover { opacity: 1; }

        .shortcuts-panel kbd {
            background: var(--glass-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            border: 1px solid var(--glass-border);
            margin: 0 2px;
        }

        .shortcuts-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 10px 14px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            z-index: 49;
            transition: all 0.2s;
        }

        .shortcuts-toggle:hover { border-color: var(--accent-purple); color: var(--text-primary); }

        /* ============================================
           EMPTY STATE
           ============================================ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .empty-state-message { font-size: 14px; }

        /* ============================================
           ACCESSIBILITY & FOCUS STATES
           ============================================ */
        .file-card:focus-visible,
        .filter-btn:focus-visible,
        .search-input:focus-visible,
        .modal-close:focus-visible {
            outline: 2px solid var(--accent-purple);
            outline-offset: 2px;
        }

        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent-purple);
            color: white;
            padding: 8px 16px;
            z-index: 1002;
            text-decoration: none;
            border-radius: 0 0 8px 0;
            transition: top 0.3s;
        }

        .skip-link:focus { top: 0; }

        /* View toggle */
        .view-toggle {
            display: flex;
            gap: 4px;
            background: var(--bg-medium);
            padding: 4px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
        }

        .view-btn {
            padding: 8px 12px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.2s;
        }

        .view-btn.active {
            background: var(--accent-purple);
            color: white;
        }

        .view-btn:hover:not(.active) {
            color: var(--text-primary);
        }

        /* List view */
        .file-grid.list-view {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .file-grid.list-view .file-card {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            gap: 16px;
        }

        .file-grid.list-view .file-icon {
            font-size: 28px;
            margin-bottom: 0;
        }

        .file-grid.list-view .file-title {
            margin-bottom: 2px;
        }

        .file-grid.list-view .file-description {
            margin-bottom: 0;
            flex: 1;
        }

        /* ============================================
           COMMAND PALETTE (Cmd+K)
           ============================================ */
        .command-palette-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 15vh;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }

        .command-palette-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .command-palette {
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 70vh;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
            transform: scale(0.95) translateY(-20px);
            transition: transform 0.2s ease;
        }

        .command-palette-overlay.show .command-palette {
            transform: scale(1) translateY(0);
        }

        .command-input-wrapper {
            padding: 16px 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .command-input-icon {
            font-size: 20px;
            color: var(--accent-purple);
        }

        .command-input {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 18px;
            font-family: 'Inter', sans-serif;
            outline: none;
        }

        .command-input::placeholder {
            color: var(--text-secondary);
        }

        .command-hint {
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .command-results {
            max-height: calc(70vh - 80px);
            overflow-y: auto;
            padding: 8px;
        }

        .command-section {
            padding: 8px 12px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .command-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .command-item:hover,
        .command-item.selected {
            background: var(--glass-bg);
        }

        .command-item.selected {
            background: rgba(119, 0, 255, 0.15);
            border: 1px solid rgba(119, 0, 255, 0.3);
        }

        .command-item-icon {
            font-size: 24px;
            width: 32px;
            text-align: center;
        }

        .command-item-content {
            flex: 1;
        }

        .command-item-title {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .command-item-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .command-item-shortcut {
            display: flex;
            gap: 4px;
        }

        .command-item-shortcut kbd {
            background: var(--bg-dark);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            border: 1px solid var(--glass-border);
        }

        /* ============================================
           3D TILT CARD EFFECT
           ============================================ */
        .file-card.tilt-effect {
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .file-card .card-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
                rgba(119, 0, 255, 0.15) 0%,
                transparent 60%);
        }

        .file-card:hover .card-glow {
            opacity: 1;
        }

        /* ============================================
           THEME TOGGLE (Dark/Light)
           ============================================ */
        .theme-toggle {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .theme-toggle:hover {
            border-color: var(--accent-purple);
            transform: scale(1.05);
        }

        /* Light theme variables */
        [data-theme="light"] {
            --bg-dark: #f5f5f7;
            --bg-medium: #ffffff;
            --bg-light: #e5e5e5;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --glass-bg: rgba(0, 0, 0, 0.03);
            --glass-border: rgba(0, 0, 0, 0.1);
        }

        [data-theme="light"] .header {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        [data-theme="light"] .file-card {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        /* ============================================
           ACTIVITY FEED
           ============================================ */
        .activity-section {
            margin-bottom: 40px;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .activity-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .activity-badge {
            background: var(--accent-purple);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }

        .activity-list {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 4px 0;
            scroll-behavior: smooth;
        }

        .activity-list::-webkit-scrollbar {
            height: 6px;
        }

        .activity-list::-webkit-scrollbar-track {
            background: var(--bg-dark);
            border-radius: 3px;
        }

        .activity-list::-webkit-scrollbar-thumb {
            background: var(--glass-border);
            border-radius: 3px;
        }

        .activity-card {
            flex-shrink: 0;
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            width: 200px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .activity-card:hover {
            border-color: var(--accent-purple);
            transform: translateY(-2px);
        }

        .activity-card-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .activity-card-name {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .activity-card-time {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* ============================================
           ONBOARDING TOUR
           ============================================ */
        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .onboarding-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .onboarding-card {
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .onboarding-overlay.show .onboarding-card {
            transform: scale(1);
        }

        .onboarding-icon {
            font-size: 64px;
            margin-bottom: 24px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .onboarding-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(45deg, var(--accent-orange), var(--accent-red), var(--accent-purple));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .onboarding-desc {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 32px;
            line-height: 1.6;
        }

        .onboarding-features {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .onboarding-feature {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            width: 120px;
            text-align: center;
        }

        .onboarding-feature-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .onboarding-feature-text {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .onboarding-progress {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .onboarding-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--glass-border);
            transition: all 0.3s ease;
        }

        .onboarding-dot.active {
            background: var(--accent-purple);
            width: 24px;
            border-radius: 4px;
        }

        .onboarding-btn {
            background: linear-gradient(45deg, var(--accent-orange), var(--accent-red));
            border: none;
            color: white;
            padding: 14px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .onboarding-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 157, 0, 0.3);
        }

        .onboarding-skip {
            background: none;
            border: none;
            color: var(--text-secondary);
            margin-left: 16px;
            cursor: pointer;
            font-size: 14px;
        }

        .onboarding-skip:hover {
            color: var(--text-primary);
        }

        /* ============================================
           CONFETTI EFFECT
           ============================================ */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 4000;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* ============================================
           PARTICLE BACKGROUND
           ============================================ */
        .particle-bg {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--accent-purple);
            border-radius: 50%;
            opacity: 0.3;
            animation: particleFloat 20s infinite linear;
        }

        @keyframes particleFloat {
            0% { transform: translateY(100vh) translateX(0); opacity: 0; }
            10% { opacity: 0.3; }
            90% { opacity: 0.3; }
            100% { transform: translateY(-100px) translateX(100px); opacity: 0; }
        }

        /* ============================================
           QUICK ACTIONS MENU
           ============================================ */
        .quick-actions {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 8px;
            min-width: 180px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            z-index: 100;
        }

        .file-card:hover .quick-actions.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .quick-action-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.15s ease;
        }

        .quick-action-item:hover {
            background: var(--glass-bg);
        }

        .quick-action-icon {
            font-size: 16px;
        }

        /* ============================================
           SOUND TOGGLE
           ============================================ */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--bg-medium);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 10px 14px;
            cursor: pointer;
            font-size: 16px;
            z-index: 50;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sound-toggle:hover {
            border-color: var(--accent-purple);
        }

        .sound-toggle .label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* ============================================
           ANIMATED STATS
           ============================================ */
        .stat-value {
            display: inline-block;
        }

        .stat-value.counting {
            animation: countPulse 0.1s ease;
        }

        @keyframes countPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* ============================================
           HEADER ENHANCEMENTS
           ============================================ */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cmd-k-hint {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .cmd-k-hint:hover {
            border-color: var(--accent-purple);
            color: var(--text-primary);
        }

        .cmd-k-hint kbd {
            background: var(--bg-dark);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
        }
    </style>
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#file-grid" class="skip-link">Skip to files</a>

    <!-- Particle Background -->
    <div class="particle-bg" id="particle-bg" aria-hidden="true"></div>

    <!-- Confetti Container -->
    <div class="confetti-container" id="confetti-container" aria-hidden="true"></div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container" role="alert" aria-live="polite"></div>

    <!-- Session Expiry Banner -->
    <div class="session-banner" id="session-banner" role="alert">
        <span id="session-message">Your session will expire in <strong id="session-countdown">5:00</strong></span>
        <button onclick="extendSession()" aria-label="Extend session">Extend Session</button>
    </div>

    <!-- Onboarding Tour -->
    <div class="onboarding-overlay" id="onboarding-overlay">
        <div class="onboarding-card">
            <div class="onboarding-icon" id="onboarding-icon">üöÄ</div>
            <h2 class="onboarding-title" id="onboarding-title">Welcome to Pitstop!</h2>
            <p class="onboarding-desc" id="onboarding-desc">Your secure gateway to the BlackRoad OS metaverse. Explore all 18 systems and manage your files with ease.</p>
            <div class="onboarding-features" id="onboarding-features">
                <div class="onboarding-feature">
                    <div class="onboarding-feature-icon">üîç</div>
                    <div class="onboarding-feature-text">Quick Search</div>
                </div>
                <div class="onboarding-feature">
                    <div class="onboarding-feature-icon">‚≠ê</div>
                    <div class="onboarding-feature-text">Favorites</div>
                </div>
                <div class="onboarding-feature">
                    <div class="onboarding-feature-icon">‚å®Ô∏è</div>
                    <div class="onboarding-feature-text">Shortcuts</div>
                </div>
            </div>
            <div class="onboarding-progress" id="onboarding-progress">
                <div class="onboarding-dot active"></div>
                <div class="onboarding-dot"></div>
                <div class="onboarding-dot"></div>
            </div>
            <div>
                <button class="onboarding-btn" id="onboarding-next">Get Started</button>
                <button class="onboarding-skip" onclick="closeOnboarding()">Skip Tour</button>
            </div>
        </div>
    </div>

    <!-- Command Palette -->
    <div class="command-palette-overlay" id="command-palette-overlay">
        <div class="command-palette">
            <div class="command-input-wrapper">
                <span class="command-input-icon">‚åò</span>
                <input type="text" class="command-input" id="command-input" placeholder="Type a command or search..." autocomplete="off" />
                <span class="command-hint">ESC to close</span>
            </div>
            <div class="command-results" id="command-results">
                <div class="command-section">Quick Actions</div>
                <div class="command-item" data-action="search">
                    <span class="command-item-icon">üîç</span>
                    <div class="command-item-content">
                        <div class="command-item-title">Search Files</div>
                        <div class="command-item-desc">Find files by name or content</div>
                    </div>
                    <div class="command-item-shortcut"><kbd>/</kbd></div>
                </div>
                <div class="command-item" data-action="theme">
                    <span class="command-item-icon">üåì</span>
                    <div class="command-item-content">
                        <div class="command-item-title">Toggle Theme</div>
                        <div class="command-item-desc">Switch between dark and light mode</div>
                    </div>
                    <div class="command-item-shortcut"><kbd>T</kbd></div>
                </div>
                <div class="command-item" data-action="favorites">
                    <span class="command-item-icon">‚≠ê</span>
                    <div class="command-item-content">
                        <div class="command-item-title">View Favorites</div>
                        <div class="command-item-desc">Show your starred files</div>
                    </div>
                    <div class="command-item-shortcut"><kbd>5</kbd></div>
                </div>
                <div class="command-item" data-action="grid">
                    <span class="command-item-icon">‚ñ¶</span>
                    <div class="command-item-content">
                        <div class="command-item-title">Grid View</div>
                        <div class="command-item-desc">Switch to grid layout</div>
                    </div>
                    <div class="command-item-shortcut"><kbd>G</kbd></div>
                </div>
                <div class="command-item" data-action="list">
                    <span class="command-item-icon">‚ò∞</span>
                    <div class="command-item-content">
                        <div class="command-item-title">List View</div>
                        <div class="command-item-desc">Switch to list layout</div>
                    </div>
                    <div class="command-item-shortcut"><kbd>L</kbd></div>
                </div>
                <div class="command-section">Files</div>
                <div id="command-files"></div>
            </div>
        </div>
    </div>

    <!-- File Preview Modal -->
    <div class="modal-overlay" id="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">
                    <span id="modal-icon">üìÑ</span>
                    <span id="modal-filename">filename.js</span>
                </h2>
                <button class="modal-close" onclick="closeModal()" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="modal-footer">
                <span id="modal-meta" class="text-secondary" style="font-size: 13px; color: var(--text-secondary);">Loading...</span>
                <div class="modal-actions">
                    <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Close</button>
                    <button class="modal-btn modal-btn-primary" id="modal-open-btn" onclick="openFileExternal()">Open File</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-left">
            <div class="logo" aria-label="Pitstop Dashboard">PITSTOP</div>
            <nav class="breadcrumb" aria-label="Breadcrumb">/ dashboard</nav>
        </div>
        <div class="header-right">
            <button class="cmd-k-hint" onclick="openCommandPalette()" title="Open command palette">
                <span>Search</span>
                <kbd>‚åòK</kbd>
            </button>
            <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
                <span id="theme-icon">üåô</span>
            </button>
            <div class="user-info" role="status" aria-label="User information">
                <div class="user-avatar" id="user-avatar" aria-hidden="true">A</div>
                <div class="user-name" id="user-name">Loading...</div>
            </div>
            <button class="logout-button" onclick="logout()" aria-label="Logout from Pitstop">Logout</button>
        </div>
    </header>

    <!-- Main Container -->
    <main class="container" role="main">
        <h1 class="page-title">Welcome to Pitstop</h1>
        <p class="page-subtitle">Secure access to all BlackRoad OS systems and files</p>

        <!-- Activity Feed / Recent Files -->
        <div class="activity-section" id="activity-section">
            <div class="activity-header">
                <div class="activity-title">
                    Recent Activity
                    <span class="activity-badge" id="activity-count">0</span>
                </div>
            </div>
            <div class="activity-list" id="activity-list">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Search & Filter Bar -->
        <div class="search-bar" role="search">
            <div class="search-input-wrapper">
                <span class="search-icon" aria-hidden="true">üîç</span>
                <input
                    type="text"
                    class="search-input"
                    id="search-input"
                    placeholder="Search files... (Press / to focus)"
                    aria-label="Search files"
                />
                <button class="search-clear" id="search-clear" aria-label="Clear search">&times;</button>
            </div>
            <div class="filter-buttons" role="group" aria-label="Filter by category">
                <button class="filter-btn active" data-filter="all">All<span class="filter-count" id="count-all">17</span></button>
                <button class="filter-btn" data-filter="live">Live<span class="filter-count" id="count-live">2</span></button>
                <button class="filter-btn" data-filter="system">System<span class="filter-count" id="count-system">12</span></button>
                <button class="filter-btn" data-filter="docs">Docs<span class="filter-count" id="count-docs">2</span></button>
                <button class="filter-btn" data-filter="favorites">‚òÖ Favorites<span class="filter-count" id="count-favorites">0</span></button>
            </div>
            <div class="view-toggle" role="group" aria-label="View mode">
                <button class="view-btn active" data-view="grid" aria-label="Grid view" title="Grid view">‚ñ¶</button>
                <button class="view-btn" data-view="list" aria-label="List view" title="List view">‚ò∞</button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìÅ</div>
                <div class="stat-label">Total Files</div>
                <div class="stat-value">32</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üåå</div>
                <div class="stat-label">Systems</div>
                <div class="stat-value">18</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üíª</div>
                <div class="stat-label">Code Lines</div>
                <div class="stat-value">14K+</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üöÄ</div>
                <div class="stat-label">Deployments</div>
                <div class="stat-value">3</div>
            </div>
        </div>

        <!-- File Grid -->
        <div class="file-grid" id="file-grid" role="grid" aria-label="File list">
            <!-- Metaverse Files -->
            <div class="file-card" onclick="openFile('universe.html')">
                <div class="file-icon">üåå</div>
                <div class="file-title">Complete Universe</div>
                <div class="file-description">Full integration of all 18 systems with beautiful UI</div>
                <div class="file-meta">
                    <span class="file-badge live">LIVE</span>
                    <span>981 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('index.html')">
                <div class="file-icon">üéÆ</div>
                <div class="file-title">Original Metaverse</div>
                <div class="file-description">First version with core features</div>
                <div class="file-meta">
                    <span class="file-badge live">LIVE</span>
                    <span>1,698 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('module-loader.js')">
                <div class="file-icon">üîó</div>
                <div class="file-title">Module Loader</div>
                <div class="file-description">Dynamic import system with dependency management</div>
                <div class="file-meta">
                    <span class="file-badge">MODULE</span>
                    <span>287 lines</span>
                </div>
            </div>

            <!-- System Files -->
            <div class="file-card" onclick="openFile('truth-contracts.js')">
                <div class="file-icon">üîê</div>
                <div class="file-title">Truth Contracts</div>
                <div class="file-description">Time scales, reference frames, and verification</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>382 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('celestial-mechanics.js')">
                <div class="file-icon">ü™ê</div>
                <div class="file-title">Celestial Mechanics</div>
                <div class="file-description">NASA-grade IAU 2000/2006 transformations</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>500 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('physics-engine.js')">
                <div class="file-icon">‚ö°</div>
                <div class="file-title">Physics Engine</div>
                <div class="file-description">Rigid body dynamics and collision detection</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>632 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('living-nature.js')">
                <div class="file-icon">ü¶ã</div>
                <div class="file-title">Living Nature</div>
                <div class="file-description">6 animals + 6 plants with AI emotions</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>1,177 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('intelligent-agents.js')">
                <div class="file-icon">ü§ñ</div>
                <div class="file-title">Intelligent Agents</div>
                <div class="file-description">Alice, Aria, Lucidia with behavior trees</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>862 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('infinite-biomes.js')">
                <div class="file-icon">üå≤</div>
                <div class="file-title">Infinite Biomes</div>
                <div class="file-description">6 procedurally generated biomes</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>492 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('photorealistic-graphics.js')">
                <div class="file-icon">üé®</div>
                <div class="file-title">Photorealistic Graphics</div>
                <div class="file-description">PBR materials and custom GLSL shaders</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>743 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('game-integration.js')">
                <div class="file-icon">üéØ</div>
                <div class="file-title">Game Integration</div>
                <div class="file-description">System orchestrator for all 17 modules</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>890 lines</span>
                </div>
            </div>

            <!-- Other Systems -->
            <div class="file-card" onclick="openFile('crafting-building.js')">
                <div class="file-icon">üõ†Ô∏è</div>
                <div class="file-title">Crafting & Building</div>
                <div class="file-description">Material system with 30+ recipes</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>741 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('quest-system.js')">
                <div class="file-icon">üèÜ</div>
                <div class="file-title">Quest System</div>
                <div class="file-description">12 unique quests with achievements</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>676 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('dialogue-story.js')">
                <div class="file-icon">üí¨</div>
                <div class="file-title">Dialogue & Story</div>
                <div class="file-description">Branching conversations and story arcs</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>674 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('world-evolution.js')">
                <div class="file-icon">üåç</div>
                <div class="file-title">World Evolution</div>
                <div class="file-description">Seasons, weather, and ecosystem simulation</div>
                <div class="file-meta">
                    <span class="file-badge">SYSTEM</span>
                    <span>673 lines</span>
                </div>
            </div>

            <!-- Documentation -->
            <div class="file-card" onclick="openFile('STATUS.md')">
                <div class="file-icon">üìä</div>
                <div class="file-title">Complete Status</div>
                <div class="file-description">Full project documentation and metrics</div>
                <div class="file-meta">
                    <span class="file-badge">DOCS</span>
                    <span>561 lines</span>
                </div>
            </div>

            <div class="file-card" onclick="openFile('DOMAIN_SETUP.md')">
                <div class="file-icon">üåê</div>
                <div class="file-title">Domain Setup Guide</div>
                <div class="file-description">Instructions for universe.blackroad.io</div>
                <div class="file-meta">
                    <span class="file-badge">DOCS</span>
                    <span>244 lines</span>
                </div>
            </div>
        </div>

        <!-- Empty State (shown when no results) -->
        <div class="empty-state" id="empty-state" style="display: none;">
            <div class="empty-state-icon">üîç</div>
            <div class="empty-state-title">No files found</div>
            <div class="empty-state-message">Try adjusting your search or filter criteria</div>
        </div>
    </main>

    <!-- Sound Toggle -->
    <button class="sound-toggle" id="sound-toggle" onclick="toggleSound()" title="Toggle sound effects">
        <span id="sound-icon">üîä</span>
        <span class="label">Sound</span>
    </button>

    <!-- Keyboard Shortcuts Panel -->
    <div class="shortcuts-panel" id="shortcuts-panel" aria-hidden="true">
        <div style="margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Keyboard Shortcuts</div>
        <div><kbd>‚åòK</kbd> Command palette</div>
        <div><kbd>/</kbd> Focus search</div>
        <div><kbd>T</kbd> Toggle theme</div>
        <div><kbd>G</kbd> Grid view</div>
        <div><kbd>L</kbd> List view</div>
        <div><kbd>?</kbd> Toggle help</div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION & CONSTANTS
        // ============================================
        const SESSION_KEY = 'blackroad_pitstop_session';
        const FAVORITES_KEY = 'blackroad_favorites';
        const SESSION_DURATION = 24 * 60 * 60 * 1000; // 24 hours
        const SESSION_WARNING_TIME = 5 * 60 * 1000; // 5 minutes before expiry

        // File database with metadata
        const FILES_DB = [
            { id: 'universe.html', name: 'Complete Universe', icon: 'üåå', desc: 'Full integration of all 18 systems with beautiful UI', lines: 981, badge: 'live', category: 'live' },
            { id: 'index.html', name: 'Original Metaverse', icon: 'üéÆ', desc: 'First version with core features', lines: 1698, badge: 'live', category: 'live' },
            { id: 'module-loader.js', name: 'Module Loader', icon: 'üîó', desc: 'Dynamic import system with dependency management', lines: 287, badge: 'module', category: 'system' },
            { id: 'truth-contracts.js', name: 'Truth Contracts', icon: 'üîê', desc: 'Time scales, reference frames, and verification', lines: 382, badge: 'system', category: 'system' },
            { id: 'celestial-mechanics.js', name: 'Celestial Mechanics', icon: 'ü™ê', desc: 'NASA-grade IAU 2000/2006 transformations', lines: 500, badge: 'system', category: 'system' },
            { id: 'physics-engine.js', name: 'Physics Engine', icon: '‚ö°', desc: 'Rigid body dynamics and collision detection', lines: 632, badge: 'system', category: 'system' },
            { id: 'living-nature.js', name: 'Living Nature', icon: 'ü¶ã', desc: '6 animals + 6 plants with AI emotions', lines: 1177, badge: 'system', category: 'system' },
            { id: 'intelligent-agents.js', name: 'Intelligent Agents', icon: 'ü§ñ', desc: 'Alice, Aria, Lucidia with behavior trees', lines: 862, badge: 'system', category: 'system' },
            { id: 'infinite-biomes.js', name: 'Infinite Biomes', icon: 'üå≤', desc: '6 procedurally generated biomes', lines: 492, badge: 'system', category: 'system' },
            { id: 'photorealistic-graphics.js', name: 'Photorealistic Graphics', icon: 'üé®', desc: 'PBR materials and custom GLSL shaders', lines: 743, badge: 'system', category: 'system' },
            { id: 'game-integration.js', name: 'Game Integration', icon: 'üéØ', desc: 'System orchestrator for all 17 modules', lines: 890, badge: 'system', category: 'system' },
            { id: 'crafting-building.js', name: 'Crafting & Building', icon: 'üõ†Ô∏è', desc: 'Material system with 30+ recipes', lines: 741, badge: 'system', category: 'system' },
            { id: 'quest-system.js', name: 'Quest System', icon: 'üèÜ', desc: '12 unique quests with achievements', lines: 676, badge: 'system', category: 'system' },
            { id: 'dialogue-story.js', name: 'Dialogue & Story', icon: 'üí¨', desc: 'Branching conversations and story arcs', lines: 674, badge: 'system', category: 'system' },
            { id: 'world-evolution.js', name: 'World Evolution', icon: 'üåç', desc: 'Seasons, weather, and ecosystem simulation', lines: 673, badge: 'system', category: 'system' },
            { id: 'STATUS.md', name: 'Complete Status', icon: 'üìä', desc: 'Full project documentation and metrics', lines: 561, badge: 'docs', category: 'docs' },
            { id: 'DOMAIN_SETUP.md', name: 'Domain Setup Guide', icon: 'üåê', desc: 'Instructions for universe.blackroad.io', lines: 244, badge: 'docs', category: 'docs' }
        ];

        const FILE_URL_MAP = {
            'universe.html': '../blackroad-metaverse/universe.html',
            'index.html': '../blackroad-metaverse/index.html',
            'module-loader.js': '../blackroad-metaverse/module-loader.js',
            'truth-contracts.js': '../blackroad-metaverse/truth-contracts.js',
            'celestial-mechanics.js': '../blackroad-metaverse/celestial-mechanics.js',
            'physics-engine.js': '../blackroad-metaverse/physics-engine.js',
            'living-nature.js': '../blackroad-metaverse/living-nature.js',
            'intelligent-agents.js': '../blackroad-metaverse/intelligent-agents.js',
            'infinite-biomes.js': '../blackroad-metaverse/infinite-biomes.js',
            'photorealistic-graphics.js': '../blackroad-metaverse/photorealistic-graphics.js',
            'game-integration.js': '../blackroad-metaverse/game-integration.js',
            'crafting-building.js': '../blackroad-metaverse/crafting-building.js',
            'quest-system.js': '../blackroad-metaverse/quest-system.js',
            'dialogue-story.js': '../blackroad-metaverse/dialogue-story.js',
            'world-evolution.js': '../blackroad-metaverse/world-evolution.js',
            'STATUS.md': '../blackroad-metaverse/STATUS.md',
            'DOMAIN_SETUP.md': '../blackroad-metaverse/DOMAIN_SETUP.md'
        };

        // ============================================
        // TOAST NOTIFICATION SYSTEM
        // ============================================
        const toastContainer = document.getElementById('toast-container');

        function showToast(type, title, message, duration = 4000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icons = { success: '‚úì', error: '‚úï', warning: '‚ö†', info: '‚Ñπ' };

            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || '‚Ñπ'}</span>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" aria-label="Close">&times;</button>
            `;

            toast.querySelector('.toast-close').onclick = () => dismissToast(toast);
            toastContainer.appendChild(toast);

            if (duration > 0) setTimeout(() => dismissToast(toast), duration);
            return toast;
        }

        function dismissToast(toast) {
            if (!toast || toast.classList.contains('hiding')) return;
            toast.classList.add('hiding');
            setTimeout(() => toast.remove(), 300);
        }

        // ============================================
        // SESSION MANAGEMENT
        // ============================================
        let sessionCheckInterval;
        let currentFile = null;

        function checkAuth() {
            const session = localStorage.getItem(SESSION_KEY);
            if (!session) {
                window.location.href = 'index.html';
                return null;
            }

            try {
                const sessionData = JSON.parse(session);
                const now = Date.now();

                if (sessionData.expires < now) {
                    localStorage.removeItem(SESSION_KEY);
                    showToast('warning', 'Session Expired', 'Redirecting to login...');
                    setTimeout(() => window.location.href = 'index.html', 1500);
                    return null;
                }

                return sessionData;
            } catch (e) {
                localStorage.removeItem(SESSION_KEY);
                window.location.href = 'index.html';
                return null;
            }
        }

        function startSessionMonitor() {
            sessionCheckInterval = setInterval(() => {
                const session = localStorage.getItem(SESSION_KEY);
                if (!session) return;

                const sessionData = JSON.parse(session);
                const timeLeft = sessionData.expires - Date.now();

                if (timeLeft <= 0) {
                    clearInterval(sessionCheckInterval);
                    showToast('error', 'Session Expired', 'Please log in again.');
                    setTimeout(() => window.location.href = 'index.html', 2000);
                } else if (timeLeft <= SESSION_WARNING_TIME) {
                    const minutes = Math.floor(timeLeft / 60000);
                    const seconds = Math.floor((timeLeft % 60000) / 1000);
                    document.getElementById('session-countdown').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    document.getElementById('session-banner').classList.add('show');
                }
            }, 1000);
        }

        function extendSession() {
            const session = localStorage.getItem(SESSION_KEY);
            if (session) {
                const sessionData = JSON.parse(session);
                sessionData.expires = Date.now() + SESSION_DURATION;
                localStorage.setItem(SESSION_KEY, JSON.stringify(sessionData));
                document.getElementById('session-banner').classList.remove('show');
                showToast('success', 'Session Extended', 'Your session has been extended for 24 hours.');
            }
        }

        // ============================================
        // FAVORITES SYSTEM
        // ============================================
        function getFavorites() {
            const data = localStorage.getItem(FAVORITES_KEY);
            return data ? JSON.parse(data) : [];
        }

        function saveFavorites(favorites) {
            localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
            updateFavoritesCount();
        }

        function toggleFavorite(fileId, event) {
            event.stopPropagation();
            const favorites = getFavorites();
            const index = favorites.indexOf(fileId);

            if (index > -1) {
                favorites.splice(index, 1);
                showToast('info', 'Removed from Favorites', `${fileId} removed from favorites`);
            } else {
                favorites.push(fileId);
                showToast('success', 'Added to Favorites', `${fileId} added to favorites`);
            }

            saveFavorites(favorites);
            renderFileGrid();
        }

        function isFavorite(fileId) {
            return getFavorites().includes(fileId);
        }

        function updateFavoritesCount() {
            document.getElementById('count-favorites').textContent = getFavorites().length;
        }

        // ============================================
        // FILE GRID RENDERING
        // ============================================
        let currentFilter = 'all';
        let currentSearch = '';
        let currentView = 'grid';

        function renderFileGrid() {
            const grid = document.getElementById('file-grid');
            const emptyState = document.getElementById('empty-state');
            const favorites = getFavorites();

            // Filter files
            let filteredFiles = FILES_DB.filter(file => {
                const matchesSearch = currentSearch === '' ||
                    file.name.toLowerCase().includes(currentSearch.toLowerCase()) ||
                    file.desc.toLowerCase().includes(currentSearch.toLowerCase()) ||
                    file.id.toLowerCase().includes(currentSearch.toLowerCase());

                const matchesFilter = currentFilter === 'all' ||
                    (currentFilter === 'favorites' && favorites.includes(file.id)) ||
                    file.category === currentFilter;

                return matchesSearch && matchesFilter;
            });

            // Clear and rebuild grid
            grid.innerHTML = '';

            if (filteredFiles.length === 0) {
                emptyState.style.display = 'block';
                grid.style.display = 'none';
            } else {
                emptyState.style.display = 'none';
                grid.style.display = '';
                grid.className = `file-grid ${currentView === 'list' ? 'list-view' : ''}`;

                filteredFiles.forEach(file => {
                    const isFav = favorites.includes(file.id);
                    const card = document.createElement('div');
                    card.className = 'file-card';
                    card.setAttribute('tabindex', '0');
                    card.setAttribute('role', 'button');
                    card.setAttribute('aria-label', `${file.name}: ${file.desc}`);
                    card.onclick = () => openFile(file.id);
                    card.onkeydown = (e) => { if (e.key === 'Enter') openFile(file.id); };

                    card.innerHTML = `
                        <button class="favorite-btn ${isFav ? 'favorited' : ''}"
                                onclick="toggleFavorite('${file.id}', event)"
                                aria-label="${isFav ? 'Remove from favorites' : 'Add to favorites'}"
                                title="${isFav ? 'Remove from favorites' : 'Add to favorites'}">
                            ${isFav ? '‚òÖ' : '‚òÜ'}
                        </button>
                        <div class="file-icon">${file.icon}</div>
                        <div class="file-title">${file.name}</div>
                        <div class="file-description">${file.desc}</div>
                        <div class="file-meta">
                            <span class="file-badge ${file.badge}">${file.badge.toUpperCase()}</span>
                            <span>${file.lines.toLocaleString()} lines</span>
                        </div>
                    `;

                    grid.appendChild(card);
                });
            }

            // Update counts
            updateFilterCounts();
        }

        function updateFilterCounts() {
            const favorites = getFavorites();
            document.getElementById('count-all').textContent = FILES_DB.length;
            document.getElementById('count-live').textContent = FILES_DB.filter(f => f.category === 'live').length;
            document.getElementById('count-system').textContent = FILES_DB.filter(f => f.category === 'system').length;
            document.getElementById('count-docs').textContent = FILES_DB.filter(f => f.category === 'docs').length;
            document.getElementById('count-favorites').textContent = favorites.length;
        }

        // ============================================
        // SEARCH & FILTER
        // ============================================
        const searchInput = document.getElementById('search-input');
        const searchClear = document.getElementById('search-clear');

        searchInput.addEventListener('input', (e) => {
            currentSearch = e.target.value;
            searchClear.classList.toggle('show', currentSearch.length > 0);
            renderFileGrid();
        });

        searchClear.addEventListener('click', () => {
            searchInput.value = '';
            currentSearch = '';
            searchClear.classList.remove('show');
            renderFileGrid();
            searchInput.focus();
        });

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                renderFileGrid();
            });
        });

        // View toggle
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentView = btn.dataset.view;
                renderFileGrid();
            });
        });

        // ============================================
        // FILE PREVIEW MODAL
        // ============================================
        const modalOverlay = document.getElementById('modal-overlay');

        function openFile(filename) {
            const file = FILES_DB.find(f => f.id === filename);
            const url = FILE_URL_MAP[filename];

            if (!file || !url) return;

            currentFile = { ...file, url };

            // For HTML files, open directly
            if (filename.endsWith('.html')) {
                window.open(url, '_blank');
                showToast('info', 'Opening File', `${file.name} opened in new tab`);
                return;
            }

            // For other files, show preview modal
            document.getElementById('modal-icon').textContent = file.icon;
            document.getElementById('modal-filename').textContent = file.name;
            document.getElementById('modal-meta').textContent = `${file.lines.toLocaleString()} lines ‚Ä¢ ${file.category.toUpperCase()}`;

            const modalBody = document.getElementById('modal-body');
            modalBody.innerHTML = '<div class="loading-spinner"><div class="spinner"></div></div>';

            modalOverlay.classList.add('show');
            document.body.style.overflow = 'hidden';

            // Simulate loading file content (in real app, fetch the file)
            setTimeout(() => {
                const sampleContent = generateSampleContent(file);
                modalBody.innerHTML = `<pre><code>${escapeHtml(sampleContent)}</code></pre>`;
            }, 500);
        }

        function generateSampleContent(file) {
            if (file.id.endsWith('.md')) {
                return `# ${file.name}\n\n${file.desc}\n\n## Overview\nThis file contains ${file.lines} lines of documentation.\n\n## Contents\n- Section 1: Introduction\n- Section 2: Configuration\n- Section 3: Usage Examples\n- Section 4: API Reference\n\n---\n*BlackRoad OS Documentation*`;
            }
            return `/**\n * ${file.name}\n * ${file.desc}\n * \n * @module ${file.id.replace('.js', '')}\n * @version 1.0.0\n * @lines ${file.lines}\n */\n\nclass ${file.name.replace(/[^a-zA-Z]/g, '')} {\n    constructor() {\n        this.initialized = false;\n        this.config = {};\n    }\n\n    async init() {\n        console.log('Initializing ${file.name}...');\n        this.initialized = true;\n        return this;\n    }\n\n    // ... ${file.lines - 20} more lines of code\n}\n\nexport default ${file.name.replace(/[^a-zA-Z]/g, '')};`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function closeModal() {
            modalOverlay.classList.remove('show');
            document.body.style.overflow = '';
            currentFile = null;
        }

        function openFileExternal() {
            if (currentFile && currentFile.url) {
                window.open(currentFile.url, '_blank');
                showToast('info', 'Opening File', `${currentFile.name} opened in new tab`);
            }
        }

        // Close modal on escape or clicking overlay
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) closeModal();
        });

        // ============================================
        // THEME TOGGLE
        // ============================================
        const THEME_KEY = 'blackroad_theme';
        let currentTheme = localStorage.getItem(THEME_KEY) || 'dark';

        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem(THEME_KEY, currentTheme);
            document.getElementById('theme-icon').textContent = currentTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
            playSound('click');
            showToast('info', 'Theme Changed', `Switched to ${currentTheme} mode`);
        }

        function initTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
            document.getElementById('theme-icon').textContent = currentTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
        }

        // ============================================
        // SOUND EFFECTS
        // ============================================
        const SOUND_KEY = 'blackroad_sound';
        let soundEnabled = localStorage.getItem(SOUND_KEY) !== 'false';

        const sounds = {
            click: () => playTone(800, 50),
            success: () => { playTone(523, 100); setTimeout(() => playTone(659, 100), 100); setTimeout(() => playTone(784, 150), 200); },
            error: () => playTone(200, 200),
            notification: () => playTone(440, 100)
        };

        function playTone(freq, duration) {
            if (!soundEnabled) return;
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.value = freq;
                gain.gain.value = 0.1;
                osc.start();
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration / 1000);
                osc.stop(ctx.currentTime + duration / 1000);
            } catch (e) {}
        }

        function playSound(type) {
            if (sounds[type]) sounds[type]();
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            localStorage.setItem(SOUND_KEY, soundEnabled);
            document.getElementById('sound-icon').textContent = soundEnabled ? 'üîä' : 'üîá';
            if (soundEnabled) playSound('click');
            showToast('info', 'Sound ' + (soundEnabled ? 'Enabled' : 'Disabled'), '');
        }

        function initSound() {
            document.getElementById('sound-icon').textContent = soundEnabled ? 'üîä' : 'üîá';
        }

        // ============================================
        // COMMAND PALETTE
        // ============================================
        const commandPaletteOverlay = document.getElementById('command-palette-overlay');
        const commandInput = document.getElementById('command-input');
        const commandFiles = document.getElementById('command-files');
        let selectedCommandIndex = 0;

        function openCommandPalette() {
            commandPaletteOverlay.classList.add('show');
            commandInput.value = '';
            commandInput.focus();
            updateCommandFiles('');
            playSound('click');
        }

        function closeCommandPalette() {
            commandPaletteOverlay.classList.remove('show');
            commandInput.value = '';
        }

        function updateCommandFiles(query) {
            const filtered = FILES_DB.filter(f =>
                f.name.toLowerCase().includes(query.toLowerCase()) ||
                f.desc.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 5);

            commandFiles.innerHTML = filtered.map(f => `
                <div class="command-item" data-file="${f.id}">
                    <span class="command-item-icon">${f.icon}</span>
                    <div class="command-item-content">
                        <div class="command-item-title">${f.name}</div>
                        <div class="command-item-desc">${f.desc}</div>
                    </div>
                </div>
            `).join('');
        }

        commandInput.addEventListener('input', (e) => {
            updateCommandFiles(e.target.value);
        });

        commandPaletteOverlay.addEventListener('click', (e) => {
            if (e.target === commandPaletteOverlay) closeCommandPalette();

            const item = e.target.closest('.command-item');
            if (item) {
                const action = item.dataset.action;
                const file = item.dataset.file;

                if (action === 'search') { closeCommandPalette(); searchInput.focus(); }
                else if (action === 'theme') { toggleTheme(); closeCommandPalette(); }
                else if (action === 'favorites') { document.querySelector('[data-filter="favorites"]').click(); closeCommandPalette(); }
                else if (action === 'grid') { document.querySelector('[data-view="grid"]').click(); closeCommandPalette(); }
                else if (action === 'list') { document.querySelector('[data-view="list"]').click(); closeCommandPalette(); }
                else if (file) { openFile(file); closeCommandPalette(); }
            }
        });

        // ============================================
        // PARTICLE BACKGROUND
        // ============================================
        function initParticles() {
            const container = document.getElementById('particle-bg');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 20}s`;
                particle.style.animationDuration = `${15 + Math.random() * 10}s`;
                container.appendChild(particle);
            }
        }

        // ============================================
        // CONFETTI EFFECT
        // ============================================
        function launchConfetti() {
            const container = document.getElementById('confetti-container');
            const colors = ['#FF9D00', '#FF006B', '#7700FF', '#0066FF', '#27AE60'];

            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                confetti.style.animationDuration = `${2 + Math.random() * 2}s`;
                container.appendChild(confetti);
            }

            setTimeout(() => container.innerHTML = '', 4000);
        }

        // ============================================
        // 3D TILT EFFECT
        // ============================================
        function init3DTilt() {
            document.addEventListener('mousemove', (e) => {
                const cards = document.querySelectorAll('.file-card');
                cards.forEach(card => {
                    const rect = card.getBoundingClientRect();
                    const x = ((e.clientX - rect.left) / rect.width) * 100;
                    const y = ((e.clientY - rect.top) / rect.height) * 100;
                    card.style.setProperty('--mouse-x', `${x}%`);
                    card.style.setProperty('--mouse-y', `${y}%`);
                });
            });
        }

        // ============================================
        // ACTIVITY FEED
        // ============================================
        const ACTIVITY_KEY = 'blackroad_activity';

        function getActivity() {
            const data = localStorage.getItem(ACTIVITY_KEY);
            return data ? JSON.parse(data) : [];
        }

        function addActivity(fileId) {
            let activity = getActivity();
            activity = activity.filter(a => a.id !== fileId);
            const file = FILES_DB.find(f => f.id === fileId);
            if (file) {
                activity.unshift({ id: fileId, timestamp: Date.now() });
                activity = activity.slice(0, 10);
                localStorage.setItem(ACTIVITY_KEY, JSON.stringify(activity));
                renderActivity();
            }
        }

        function renderActivity() {
            const activity = getActivity();
            const list = document.getElementById('activity-list');
            const section = document.getElementById('activity-section');

            if (activity.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            document.getElementById('activity-count').textContent = activity.length;

            list.innerHTML = activity.map(a => {
                const file = FILES_DB.find(f => f.id === a.id);
                if (!file) return '';
                const timeAgo = getTimeAgo(a.timestamp);
                return `
                    <div class="activity-card" onclick="openFile('${file.id}')">
                        <div class="activity-card-icon">${file.icon}</div>
                        <div class="activity-card-name">${file.name}</div>
                        <div class="activity-card-time">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }

        function getTimeAgo(timestamp) {
            const diff = Date.now() - timestamp;
            const mins = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            if (mins < 1) return 'Just now';
            if (mins < 60) return `${mins}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        // ============================================
        // ONBOARDING TOUR
        // ============================================
        const ONBOARDING_KEY = 'blackroad_onboarding_done';
        let onboardingStep = 0;

        const onboardingSteps = [
            {
                icon: 'üöÄ',
                title: 'Welcome to Pitstop!',
                desc: 'Your secure gateway to the BlackRoad OS metaverse. Explore all 18 systems and manage your files with ease.',
                features: [
                    { icon: 'üîç', text: 'Quick Search' },
                    { icon: '‚≠ê', text: 'Favorites' },
                    { icon: '‚å®Ô∏è', text: 'Shortcuts' }
                ]
            },
            {
                icon: '‚åò',
                title: 'Command Palette',
                desc: 'Press ‚åòK (or Ctrl+K) anytime to open the command palette. Search files, toggle theme, and more!',
                features: [
                    { icon: 'üîç', text: 'Search Files' },
                    { icon: 'üåì', text: 'Toggle Theme' },
                    { icon: '‚ö°', text: 'Quick Actions' }
                ]
            },
            {
                icon: '‚ú®',
                title: 'You\'re All Set!',
                desc: 'Explore the metaverse, star your favorite files, and enjoy the journey through BlackRoad OS.',
                features: [
                    { icon: 'üåå', text: '18 Systems' },
                    { icon: 'üìÅ', text: '32+ Files' },
                    { icon: 'üöÄ', text: 'Infinite Fun' }
                ]
            }
        ];

        function showOnboarding() {
            if (localStorage.getItem(ONBOARDING_KEY)) return;
            document.getElementById('onboarding-overlay').classList.add('show');
            renderOnboardingStep();
        }

        function renderOnboardingStep() {
            const step = onboardingSteps[onboardingStep];
            document.getElementById('onboarding-icon').textContent = step.icon;
            document.getElementById('onboarding-title').textContent = step.title;
            document.getElementById('onboarding-desc').textContent = step.desc;

            document.getElementById('onboarding-features').innerHTML = step.features.map(f => `
                <div class="onboarding-feature">
                    <div class="onboarding-feature-icon">${f.icon}</div>
                    <div class="onboarding-feature-text">${f.text}</div>
                </div>
            `).join('');

            document.getElementById('onboarding-progress').innerHTML = onboardingSteps.map((_, i) =>
                `<div class="onboarding-dot ${i === onboardingStep ? 'active' : ''}"></div>`
            ).join('');

            document.getElementById('onboarding-next').textContent =
                onboardingStep === onboardingSteps.length - 1 ? 'Let\'s Go!' : 'Next';
        }

        document.getElementById('onboarding-next').addEventListener('click', () => {
            onboardingStep++;
            if (onboardingStep >= onboardingSteps.length) {
                closeOnboarding();
                launchConfetti();
            } else {
                renderOnboardingStep();
            }
        });

        function closeOnboarding() {
            document.getElementById('onboarding-overlay').classList.remove('show');
            localStorage.setItem(ONBOARDING_KEY, 'true');
        }

        // ============================================
        // KEYBOARD SHORTCUTS
        // ============================================
        const shortcutsPanel = document.getElementById('shortcuts-panel');
        let shortcutsVisible = true;

        document.addEventListener('keydown', (e) => {
            // Command palette shortcut
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                if (commandPaletteOverlay.classList.contains('show')) {
                    closeCommandPalette();
                } else {
                    openCommandPalette();
                }
                return;
            }

            // Close overlays on Escape
            if (e.key === 'Escape') {
                if (commandPaletteOverlay.classList.contains('show')) {
                    closeCommandPalette();
                    return;
                }
                if (modalOverlay.classList.contains('show')) {
                    closeModal();
                    return;
                }
                if (document.getElementById('onboarding-overlay').classList.contains('show')) {
                    closeOnboarding();
                    return;
                }
            }

            // Ignore if typing in input
            if (e.target.tagName === 'INPUT') {
                if (e.key === 'Escape') {
                    e.target.blur();
                    if (e.target === commandInput) {
                        closeCommandPalette();
                    } else {
                        searchInput.value = '';
                        currentSearch = '';
                        searchClear.classList.remove('show');
                        renderFileGrid();
                    }
                }
                return;
            }

            switch (e.key.toLowerCase()) {
                case '/':
                    e.preventDefault();
                    searchInput.focus();
                    break;
                case 't':
                    toggleTheme();
                    break;
                case 'g':
                    document.querySelector('[data-view="grid"]').click();
                    showToast('info', 'View Changed', 'Switched to grid view');
                    break;
                case 'l':
                    document.querySelector('[data-view="list"]').click();
                    showToast('info', 'View Changed', 'Switched to list view');
                    break;
                case '?':
                    shortcutsVisible = !shortcutsVisible;
                    shortcutsPanel.style.display = shortcutsVisible ? 'block' : 'none';
                    break;
                case '1': document.querySelector('[data-filter="all"]').click(); break;
                case '2': document.querySelector('[data-filter="live"]').click(); break;
                case '3': document.querySelector('[data-filter="system"]').click(); break;
                case '4': document.querySelector('[data-filter="docs"]').click(); break;
                case '5': document.querySelector('[data-filter="favorites"]').click(); break;
            }
        });

        // ============================================
        // ENHANCED FILE OPEN (with activity tracking)
        // ============================================
        const originalOpenFile = openFile;
        openFile = function(filename) {
            addActivity(filename);
            playSound('click');
            originalOpenFile(filename);
        };

        // ============================================
        // LOGOUT
        // ============================================
        function logout() {
            playSound('notification');
            showToast('info', 'Logging Out', 'See you soon!');
            setTimeout(() => {
                localStorage.removeItem(SESSION_KEY);
                window.location.href = 'index.html';
            }, 1000);
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        const session = checkAuth();
        if (session) {
            document.getElementById('user-name').textContent = session.username;
            document.getElementById('user-avatar').textContent = session.username.charAt(0).toUpperCase();

            // Initialize all systems
            initTheme();
            initSound();
            initParticles();
            init3DTilt();
            startSessionMonitor();
            renderFileGrid();
            renderActivity();

            // Show onboarding for first-time users
            setTimeout(() => showOnboarding(), 500);

            // Welcome message
            setTimeout(() => {
                playSound('success');
                showToast('success', `Welcome, ${session.username}!`, 'You have access to all BlackRoad files.');
            }, 300);
        }
    </script>
</body>
</html>
